<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Prevents double-tap to zoom on mobile */
        }
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: 100%;
            max-width: 500px; /* Max width for larger screens */
            aspect-ratio: 1 / 1;
            border: 3px solid #1f2937; /* gray-800 */
            border-radius: 8px;
            background-color: #f3f4f6; /* gray-100 */
        }
        .sudoku-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1rem, 5vw, 1.75rem); /* Responsive font size */
            border: 1px solid #d1d5db; /* gray-300 */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        /* Add thicker borders for the 3x3 subgrids */
        .sudoku-cell:nth-child(3n) { border-right-width: 2px; border-right-color: #4b5563; }
        .sudoku-cell:nth-child(9n) { border-right-width: 3px; border-right-color: #1f2937; }
        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54) { border-bottom-width: 2px; border-bottom-color: #4b5563; }
        .sudoku-cell:nth-child(n+73):nth-child(-n+81) { border-bottom-width: 3px; border-bottom-color: #1f2937; }

        .fixed-number {
            font-weight: 700;
            color: #1f2937; /* gray-800 */
        }
        .user-number {
            color: #2563eb; /* blue-600 */
        }
        .selected {
            background-color: #93c5fd !important; /* blue-300 */
        }
        .highlighted {
            background-color: #dbeafe; /* blue-100 */
        }
        .error {
            color: #dc2626; /* red-600 */
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .win-modal {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <header class="text-center mb-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Sudoku</h1>
            <p class="text-gray-600">Select a difficulty and start solving!</p>
        </header>

        <!-- Game Controls -->
        <div class="flex flex-wrap justify-center gap-2 mb-4">
            <div class="flex items-center gap-2">
                <label for="difficulty" class="font-medium">Difficulty:</label>
                <select id="difficulty" class="bg-white border border-gray-300 rounded-md px-3 py-1.5 text-sm shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                    <option value="expert">Expert</option>
                </select>
            </div>
            <button id="new-game-btn" class="bg-blue-600 text-white font-semibold px-4 py-1.5 rounded-md shadow-sm hover:bg-blue-700 transition-colors">New Game</button>
        </div>

        <!-- Game Info Bar -->
        <div class="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm mb-4">
             <div class="text-center">
                <div class="text-sm font-medium text-gray-500">Mistakes</div>
                <div id="mistakes-counter" class="text-lg font-bold">0 / 3</div>
            </div>
            <div class="text-center">
                <div class="text-sm font-medium text-gray-500">Time</div>
                <div id="timer" class="text-lg font-bold">00:00</div>
            </div>
        </div>

        <!-- Sudoku Grid -->
        <div id="sudoku-grid" class="sudoku-grid mx-auto shadow-lg"></div>

        <!-- Number Palette & Actions -->
        <div class="mt-4 flex flex-col items-center gap-4">
            <div id="number-palette" class="flex justify-center gap-1 sm:gap-2">
                <!-- Numbers 1-9 will be generated here -->
            </div>
            <div class="flex justify-center gap-2 sm:gap-4">
                 <button id="hint-btn" class="bg-yellow-500 text-white font-semibold px-4 py-2 rounded-md shadow-sm hover:bg-yellow-600 transition-colors flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightbulb" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6 8.5a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 0 1h-.5a.5.5 0 0 1-.5-.5zM8 1a4 4 0 0 0-4 4a4 4 0 0 0 .175.995c.122.253.29.49.495.698l.203.196c.246.236.46.49.634.757l.762 1.769h3.46l.762-1.769a2.965 2.965 0 0 0 .634-.757l.203-.196a2.965 2.965 0 0 0 .495-.698A4 4 0 0 0 12 5a4 4 0 0 0-4-4z"/></svg>
                    Hint (<span id="hints-left">3</span>)
                </button>
                 <button id="solve-btn" class="bg-green-600 text-white font-semibold px-4 py-2 rounded-md shadow-sm hover:bg-green-700 transition-colors">Solve</button>
            </div>
        </div>
    </div>

    <!-- Win/Lose Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="win-modal bg-white rounded-lg shadow-xl p-8 text-center max-w-sm w-full">
            <h2 id="modal-title" class="text-3xl font-bold mb-4"></h2>
            <p id="modal-text" class="text-gray-700 mb-6"></p>
            <button id="modal-new-game-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors w-full">Play Again</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const gridElement = document.getElementById('sudoku-grid');
            const numberPalette = document.getElementById('number-palette');
            const newGameBtn = document.getElementById('new-game-btn');
            const difficultySelect = document.getElementById('difficulty');
            const mistakesCounter = document.getElementById('mistakes-counter');
            const timerElement = document.getElementById('timer');
            const solveBtn = document.getElementById('solve-btn');
            const hintBtn = document.getElementById('hint-btn');
            const hintsLeftSpan = document.getElementById('hints-left');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
            const modalNewGameBtn = document.getElementById('modal-new-game-btn');

            // --- Game State ---
            let board = [];
            let solution = [];
            let selectedCell = null;
            let mistakes = 0;
            let maxMistakes = 3;
            let timerInterval;
            let seconds = 0;
            let hintsLeft = 3;
            let isGameOver = false;

            const difficultySettings = {
                easy: 40,
                medium: 50,
                hard: 55,
                expert: 60,
            };

            // --- Sudoku Generation and Solving Logic ---

            /**
             * Generates a complete, valid Sudoku board using backtracking.
             */
            function generateSolution() {
                const newBoard = Array(9).fill(0).map(() => Array(9).fill(0));
                const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];

                function solve(grid) {
                    for (let r = 0; r < 9; r++) {
                        for (let c = 0; c < 9; c++) {
                            if (grid[r][c] === 0) {
                                shuffleArray(numbers);
                                for (let num of numbers) {
                                    if (isValid(grid, r, c, num)) {
                                        grid[r][c] = num;
                                        if (solve(grid)) {
                                            return true;
                                        }
                                        grid[r][c] = 0; // Backtrack
                                    }
                                }
                                return false;
                            }
                        }
                    }
                    return true; // Board is full
                }
                
                solve(newBoard);
                return newBoard;
            }

            /**
             * Checks if placing a number in a cell is valid.
             */
            function isValid(grid, row, col, num) {
                // Check row
                for (let x = 0; x < 9; x++) {
                    if (grid[row][x] === num) return false;
                }
                // Check column
                for (let x = 0; x < 9; x++) {
                    if (grid[x][col] === num) return false;
                }
                // Check 3x3 subgrid
                const startRow = row - row % 3;
                const startCol = col - col % 3;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (grid[i + startRow][j + startCol] === num) return false;
                    }
                }
                return true;
            }
            
            /**
             * Shuffles an array in place (Fisher-Yates shuffle).
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }


            /**
             * Creates a puzzle by removing numbers from a full solution.
             */
            function createPuzzle(difficulty) {
                solution = generateSolution();
                board = JSON.parse(JSON.stringify(solution)); // Deep copy
                
                let cellsToRemove = difficultySettings[difficulty];
                let attempts = 0;
                
                while (cellsToRemove > 0 && attempts < 200) {
                    const row = Math.floor(Math.random() * 9);
                    const col = Math.floor(Math.random() * 9);

                    if (board[row][col] !== 0) {
                        board[row][col] = 0;
                        cellsToRemove--;
                    }
                    attempts++;
                }
            }

            // --- UI and Game Flow ---

            /**
             * Initializes and starts a new game.
             */
            function startGame() {
                isGameOver = false;
                const difficulty = difficultySelect.value;
                createPuzzle(difficulty);
                drawBoard();
                resetGameStats();
                startTimer();
            }

            /**
             * Renders the Sudoku board in the DOM.
             */
            function drawBoard() {
                gridElement.innerHTML = '';
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        const cell = document.createElement('div');
                        cell.classList.add('sudoku-cell');
                        cell.dataset.row = r;
                        cell.dataset.col = c;

                        if (board[r][c] !== 0) {
                            cell.textContent = board[r][c];
                            cell.classList.add('fixed-number');
                        } else {
                            cell.addEventListener('click', () => handleCellClick(cell, r, c));
                        }
                        gridElement.appendChild(cell);
                    }
                }
            }
            
            /**
             * Resets game statistics like timer, mistakes, and hints.
             */
            function resetGameStats() {
                mistakes = 0;
                mistakesCounter.textContent = `${mistakes} / ${maxMistakes}`;
                mistakesCounter.classList.remove('text-red-600');
                
                hintsLeft = 3;
                hintsLeftSpan.textContent = hintsLeft;
                hintBtn.disabled = false;
                hintBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                seconds = 0;
                timerElement.textContent = '00:00';
                clearInterval(timerInterval);
            }

            /**
             * Starts the game timer.
             */
            function startTimer() {
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    if (!isGameOver) {
                        seconds++;
                        const min = Math.floor(seconds / 60).toString().padStart(2, '0');
                        const sec = (seconds % 60).toString().padStart(2, '0');
                        timerElement.textContent = `${min}:${sec}`;
                    }
                }, 1000);
            }

            /**
             * Handles clicking on an empty cell.
             */
            function handleCellClick(cell, row, col) {
                if (isGameOver) return;

                if (selectedCell) {
                    selectedCell.element.classList.remove('selected');
                }
                
                // Deselect if clicking the same cell
                if (selectedCell && selectedCell.row === row && selectedCell.col === col) {
                    selectedCell = null;
                    clearHighlights();
                    return;
                }

                selectedCell = { element: cell, row, col };
                cell.classList.add('selected');
                highlightRelatedCells(row, col);
            }

            /**
             * Highlights the row, column, and subgrid of the selected cell.
             */
            function highlightRelatedCells(row, col) {
                clearHighlights();
                const cells = gridElement.children;
                for (let i = 0; i < cells.length; i++) {
                    const cell = cells[i];
                    const r = parseInt(cell.dataset.row);
                    const c = parseInt(cell.dataset.col);
                    const startRow = row - row % 3;
                    const startCol = col - col % 3;

                    if (r === row || c === col || (r >= startRow && r < startRow + 3 && c >= startCol && c < startCol + 3)) {
                        cell.classList.add('highlighted');
                    }
                }
                 // Re-apply selected style as it might be overwritten by highlight
                if(selectedCell) selectedCell.element.classList.add('selected');
            }
            
            /**
             * Removes all cell highlights.
             */
            function clearHighlights() {
                const cells = gridElement.children;
                for (let i = 0; i < cells.length; i++) {
                    cells[i].classList.remove('highlighted');
                }
            }

            /**
             * Places a number from the palette into the selected cell.
             */
            function placeNumber(num) {
                if (!selectedCell || isGameOver) return;

                const { element, row, col } = selectedCell;
                if (element.classList.contains('fixed-number')) return;

                if (solution[row][col] === num) {
                    element.textContent = num;
                    element.classList.add('user-number');
                    element.classList.remove('error');
                    board[row][col] = num; // Update board state
                    
                    // Remove click listener after correct placement
                    element.removeEventListener('click', () => handleCellClick(element, row, col));
                    
                    selectedCell = null;
                    element.classList.remove('selected');
                    clearHighlights();
                    
                    checkWinCondition();
                } else {
                    mistakes++;
                    mistakesCounter.textContent = `${mistakes} / ${maxMistakes}`;
                    element.classList.add('error');
                    setTimeout(() => element.classList.remove('error'), 500);

                    if (mistakes >= maxMistakes) {
                        endGame(false); // Player loses
                    }
                }
            }
            
            /**
             * Checks if the game has been won.
             */
            function checkWinCondition() {
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (board[r][c] === 0 || board[r][c] !== solution[r][c]) {
                            return; // Game not won yet
                        }
                    }
                }
                endGame(true); // Player wins
            }

            /**
             * Ends the game, showing a win or lose modal.
             */
            function endGame(isWin) {
                isGameOver = true;
                clearInterval(timerInterval);
                
                if (isWin) {
                    modalTitle.textContent = 'Congratulations!';
                    modalText.textContent = `You solved the puzzle in ${timerElement.textContent} with ${mistakes} mistakes.`;
                } else {
                    modalTitle.textContent = 'Game Over';
                    modalText.textContent = `You made too many mistakes. Better luck next time!`;
                }
                modal.classList.remove('hidden');
            }

            /**
             * Fills the board with the complete solution.
             */
            function solvePuzzle() {
                isGameOver = true;
                clearInterval(timerInterval);
                board = JSON.parse(JSON.stringify(solution));
                const cells = gridElement.children;
                for(let i=0; i<cells.length; i++) {
                    const cell = cells[i];
                    const r = parseInt(cell.dataset.row);
                    const c = parseInt(cell.dataset.col);
                    if (!cell.classList.contains('fixed-number')) {
                        cell.textContent = solution[r][c];
                        cell.classList.add('user-number');
                        cell.classList.remove('error');
                    }
                }
            }
            
            /**
             * Provides a hint by filling a random empty cell.
             */
            function giveHint() {
                if (hintsLeft <= 0 || isGameOver) return;
                
                const emptyCells = [];
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (board[r][c] === 0) {
                            emptyCells.push({r, c});
                        }
                    }
                }
                
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    const {r, c} = randomCell;
                    const cellElement = gridElement.children[r * 9 + c];
                    
                    // Temporarily select and place the number
                    handleCellClick(cellElement, r, c);
                    placeNumber(solution[r][c]);
                    
                    hintsLeft--;
                    hintsLeftSpan.textContent = hintsLeft;
                    if (hintsLeft === 0) {
                        hintBtn.disabled = true;
                        hintBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            }

            // --- Initial Setup ---
            function init() {
                // Create number palette
                for (let i = 1; i <= 9; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.classList.add('w-10', 'h-10', 'sm:w-12', 'sm:h-12', 'bg-white', 'border', 'border-gray-300', 'rounded-md', 'text-lg', 'font-semibold', 'shadow-sm', 'hover:bg-blue-100', 'focus:ring-2', 'focus:ring-blue-500', 'transition-colors');
                    btn.addEventListener('click', () => placeNumber(i));
                    numberPalette.appendChild(btn);
                }

                // Event Listeners
                newGameBtn.addEventListener('click', startGame);
                solveBtn.addEventListener('click', solvePuzzle);
                hintBtn.addEventListener('click', giveHint);
                modalNewGameBtn.addEventListener('click', () => {
                    modal.classList.add('hidden');
                    startGame();
                });
                
                // Start the first game
                startGame();
            }

            init();
        });
    </script>
</body>
</html>
